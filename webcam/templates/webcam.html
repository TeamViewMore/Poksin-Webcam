{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Stream</title>
    <link rel="stylesheet" href="{% static 'css/webcam.css' %}">
    <style>

    </style>
</head>
<body>
    <div class="home">
        <a href="{% url 'index' %}">
            <img src="{% static 'img/home.png' %}" alt="home"> <span>홈으로</span>
        </a>
    </div>
    <div class="webcam-container" id="webcamContainer" onclick="toggleWebcam()">
        <video id="webcamFeed" autoplay playsinline muted style="display: none;"></video>
        <img id="staticImage" src="{% static 'img/stop_video.png' %}" alt="Static Image">
    </div>
    
    <script>
        let isWebcamOn = false; 
        const webcamFeed = document.getElementById('webcamFeed');
        const staticImage = document.getElementById('staticImage');

        function toggleWebcam() {
            if (isWebcamOn) {
                stopWebcam();
            } else {
                startWebcam();
            }
        }

        function startWebcam() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        webcamFeed.srcObject = stream;
                        isWebcamOn = true;
                        staticImage.style.display = 'none';  
                        webcamFeed.style.display = 'block';  
                    })
                    .catch(function(error) {
                        console.error("Error accessing webcam: ", error);
                        alert("Unable to access webcam. Please check your permissions.");
                    });
            } else {
                alert("Webcam not supported by your browser.");
            }
        }

        function stopWebcam() {
            const stream = webcamFeed.srcObject;
            // if (stream) {
            //     stream.getTracks().forEach(track => track.stop());
            //     webcamFeed.srcObject = null;
            // }
            isWebcamOn = false;
            staticImage.style.display = 'block';  
            webcamFeed.style.display = 'none';    
        }
    </script>
</body>
</html>
